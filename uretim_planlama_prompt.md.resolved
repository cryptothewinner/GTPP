# SepeNatural Ä°leri Seviye Ãœretim Planlama Sistemi TasarÄ±mÄ±

## ğŸ“Œ Proje Ã–zeti ve Hedef
**Proje:** SepeNatural ERP (Next.js 16 + NestJS + Prisma)
**Mevcut Durum:** Basit bir AG Grid listesi ([production/planning/page.tsx](file:///c:/Users/PC/.gemini/antigravity/scratch/sepe4.6/apps/web/src/app/%28dashboard%29/production/planning/page.tsx)).
**Hedef:** Ä°laÃ§ ve gÄ±da takviyesi Ã¼retimine Ã¶zel, **Ã§oklu gÃ¶rÃ¼nÃ¼me sahip (Multi-View)**, sÃ¼rÃ¼kle-bÄ±rak destekli, malzeme/kaynak kontrollÃ¼, **premium UI/UX** standartlarÄ±nda bir "Ãœretim Planlama Merkezi" oluÅŸturmak.

---

## ğŸ¨ UI/UX Vizyonu & TasarÄ±m Dili
*   **Tema:** Salesforce Lightning Design System (SLDS) ve "Glassmorphism" dokunuÅŸlarÄ±.
*   **Renk Paleti:**
    *   *PlanlandÄ±:* `#3B82F6` (Blue)
    *   *Devam Ediyor:* `#F59E0B` (Amber - Pulse animasyonlu)
    *   *Kalite Kontrol:* `#8B5CF6` (Purple)
    *   *TamamlandÄ±:* `#10B981` (Emerald)
    *   *Kritik:* `#EF4444` (Red)
*   **Navigasyon:** Sayfa iÃ§i **Tabs (Sekmeler)** yapÄ±sÄ±:
    1.  ğŸ“‹ **Ä°ÅŸ Emirleri Listesi** (DetaylÄ± Grid)
    2.  ğŸ“… **Ãœretim Takvimi** (Timeline/Gantt)
    3.  ğŸ—ï¸ **Kanban Panosu** (SÃ¼reÃ§ AkÄ±ÅŸÄ±)
    4.  ğŸ“¦ **Malzeme & Kaynak** (YÃ¼k Analizi)

---

## ğŸ› ï¸ Teknik Gereksinimler & KÃ¼tÃ¼phaneler
*   **Grid:** `ag-grid-enterprise` (Mevcut, Tree Data ve Grouping kullanÄ±lacak. **Not:** Lisans anahtarÄ± yoksa geliÅŸtirme ortamÄ±nda watermark ile Ã§alÄ±ÅŸÄ±r, prodÃ¼ksiyon iÃ§in lisans gerekir).
*   **Takvim:** `react-big-calendar` veya `@scheduler/react`
*   **SÃ¼rÃ¼kle-BÄ±rak:** `@dnd-kit/core` (Kanban ve Takvim iÃ§in)
*   **Grafikler:** `recharts` (Kaynak doluluk oranlarÄ± iÃ§in)
*   **Ä°konlar:** `lucide-react`
*   **Form:** `react-hook-form` + `zod`

---

## ğŸ“‹ GÃ–RÃœNÃœM 1: GeliÅŸmiÅŸ Ä°ÅŸ Emirleri Listesi (Smart Grid)
Mevcut grid aÅŸaÄŸÄ±daki Ã¶zelliklerle gÃ¼Ã§lendirilecek:

1.  **Dinamik Durum GÃ¶stergeleri:**
    *   Renkli badge'ler (`STATUS_MAP`).
    *   "Ä°lerleme Ã‡ubuÄŸu" kolonu (Batch doluluk oranÄ±na gÃ¶re).
    *   "Gecikme" uyarÄ±sÄ± (EÄŸer `plannedEnd < today` ve bitmediyse kÄ±rmÄ±zÄ± satÄ±r).

2.  **AkÄ±llÄ± Kolonlar:**
    *   **ÃœrÃ¼n:** Resim + Ad + Kod (HÃ¼cre iÃ§inde mini kart).
    *   **ReÃ§ete:** ReÃ§ete versiyonu ve toplam maliyet tooltip'i.
    *   **Malzeme KontrolÃ¼ (YENÄ°):** Trafik IÅŸÄ±ÄŸÄ± Sistemi ğŸŸ¢ğŸŸ¡ğŸ”´
        *   Backend her emir iÃ§in stok kontrolÃ¼ yapar.
        *   ğŸŸ¢ TÃ¼m malzemeler hazÄ±r.
        *   ğŸŸ¡ BazÄ± malzemeler kritik seviyede.
        *   ğŸ”´ Malzeme eksik, Ã¼retime baÅŸlanamaz.

3.  **HÄ±zlÄ± Aksiyonlar (Row Actions):**
    *   ğŸ–±ï¸ **BaÅŸlat:** Durumu `IN_PROGRESS`e Ã§eker (Sadece malzeme varsa).
    *   ğŸ–±ï¸ **Tamamla:** Durumu `QC_PENDING`e Ã§eker.
    *   ğŸ–±ï¸ **Planla:** Tarih gÃ¼ncelleme modalÄ± aÃ§ar.

---

## ğŸ“… GÃ–RÃœNÃœM 2: Ãœretim Takvimi (Resource Scheduler)
*   **X Ekseni:** Zaman (GÃ¼n/Hafta/Ay).
*   **Y Ekseni:** Kaynaklar (Ãœretim HattÄ± 1, HattÄ± 2, Dolum Makinesi vb. - *Metadata'dan Ã§ekilebilir veya statik tanÄ±mlanabilir*).
*   **Eventler:** Ä°ÅŸ emirleri (`plannedStart` - `plannedEnd` aralÄ±ÄŸÄ±).
*   **Ä°ÅŸlev:**
    *   Bir iÅŸ emrini sÃ¼rÃ¼kleyip baÅŸka bir gÃ¼ne bÄ±rakÄ±nca `updateProductionOrder` endpoint'i tetiklenir.
    *   Event Ã¼zerine tÄ±klayÄ±nca detay pop-up aÃ§Ä±lÄ±r.

---

## ğŸ—ï¸ GÃ–RÃœNÃœM 3: Kanban Panosu (Process Flow)
*   **SÃ¼tunlar:** `DRAFT` â†’ `PLANNED` â†’ `IN_PROGRESS` â†’ `COMPLETED`.
*   **Kart YapÄ±sÄ±:**
    *   **Header:** `UE-2024-001` (Bold) | ÃœrÃ¼n AdÄ±
    *   **Body:** 5000 Adet | BaÅŸlangÄ±Ã§: 14 Åub
    *   **Footer:** Atanan KiÅŸi (Avatar) | Ä°lerleme BarÄ± %45
*   **SÃ¼rÃ¼kle-BÄ±rak:** SÃ¼tunlar arasÄ± geÃ§iÅŸte statÃ¼ gÃ¼ncellenir.
*   **KÄ±sÄ±t:** Malzeme yoksa `PLANNED` â†’ `IN_PROGRESS` geÃ§iÅŸine izin verme (Hata toast'Ä± gÃ¶ster).

---

## ğŸ“¦ GÃ–RÃœNÃœM 4: Kaynak & Malzeme Analizi
*   **Grafik:** Ãœretim planÄ±na gÃ¶re gelecek 30 gÃ¼ndeki hammadde ihtiyacÄ±.
    *   "Hangi hafta ne kadar Vitamin C lazÄ±m?"
    *   Mevcut stok Ã§izgisi ile ihtiyaÃ§ Ã§ubuklarÄ±nÄ± karÅŸÄ±laÅŸtÄ±r.
*   **KPI KartlarÄ±:**
    *   "Kritik Malzemeler" (Stok yetersiz olanlar).
    *   "BoÅŸ Kapasite" (Ãœretim hattÄ± doluluk oranÄ±).

---

## âš™ï¸ BACKEND (NestJS) GeliÅŸtirmeleri

### 1. [ProductionOrderService](file:///c:/Users/PC/.gemini/antigravity/scratch/sepe4.6/apps/api/src/modules/production-order/production-order.service.ts#14-171)
*   `checkMaterialAvailability(orderId)` metodu:
    *   Order â†’ Recipe â†’ RecipeItems Ã§ek.
    *   Her item iÃ§in `Material.currentStock` kontrol et.
    *   Return: `{ isAvailable: boolean, missingItems: [] }`

### 2. [ProductionOrderController](file:///c:/Users/PC/.gemini/antigravity/scratch/sepe4.6/apps/api/src/modules/production-order/production-order.controller.ts#6-59)
*   `GET /:id/availability` endpoint'i.
*   `PATCH /:id/reschedule` endpoint'i (Sadece tarihleri gÃ¼nceller, log kaydÄ± atar).

### 3. Seed Data
*   Ãœretim hatlarÄ± veya istasyonlarÄ± iÃ§in `EntityMetadata` veya basit bir [const](file:///c:/Users/PC/.gemini/antigravity/scratch/sepe4.6/apps/api/src/modules/product/product.service.ts#15-16) tanÄ±mÄ± ekle (Takvim gÃ¶rÃ¼nÃ¼mÃ¼ iÃ§in).

---

## ğŸš€ Uygulama AdÄ±mlarÄ± (Prompt SÄ±rasÄ±)

1.  **Backend HazÄ±rlÄ±ÄŸÄ±:**
    *   `checkMaterialAvailability` servisini yaz.
    *   API endpoint'ini aÃ§.
2.  **Hook & Type:**
    *   `useMaterialCheck` hook'unu ve `MaterialCheckResponse` tipini oluÅŸtur.
3.  **UI Ä°skeleti:**
    *   [page.tsx](file:///c:/Users/PC/.gemini/antigravity/scratch/sepe4.6/apps/web/src/app/%28dashboard%29/inventory/page.tsx)'i Tab yapÄ±sÄ±na Ã§evir.
    *   `PlanningTabs` component'i oluÅŸtur.
4.  **GÃ¶rÃ¼nÃ¼mlerin KodlanmasÄ±:**
    *   `PlanningGrid.tsx` (Mevcut grid'in upgrade hali).
    *   `PlanningKanban.tsx` (dnd-kit ile).
    *   `PlanningCalendar.tsx` (Big Calendar ile).
5.  **Entegrasyon:**
    *   Malzeme kontrolÃ¼nÃ¼ Grid ve Kanban'a entegre et (Renk/Ä°kon deÄŸiÅŸimi).
    *   SÃ¼rÃ¼kle-bÄ±rak iÅŸlemlerini API'ye baÄŸla.

---

## ğŸ’¡ Ã–nemli Notlar
*   **Performans:** Grid sayfalama (pagination) kullanmalÄ±, ancak Kanban ve Takvim iÃ§in belirli bir tarih aralÄ±ÄŸÄ± (Ã¶rn. bu ay) Ã§ekilmeli.
*   **Hata YÃ¶netimi:** SÃ¼rÃ¼kle-bÄ±rak baÅŸarÄ±sÄ±z olursa UI eski haline dÃ¶nmeli (Optimistic UI).
*   **SepeNatural Ã–zel:** GÄ±da takviyesi Ã¼retiminde "Temizlik ArasÄ±" (Clearance) Ã¶nemlidir. Ä°ki Ã¼retim arasÄ±na otomatik 2 saatlik boÅŸluk bÄ±rakÄ±labilir (Opsiyonel ileri seviye Ã¶zellik).
