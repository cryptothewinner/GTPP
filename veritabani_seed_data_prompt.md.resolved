# SepeNatural VeritabanÄ± Analizi & Seed Data Dolum Prompt'u

## Proje BaÄŸlamÄ±

Proje: SepeNatural ERP â€” `c:\Users\PC\.gemini\antigravity\scratch\sepe4.6`
Mevcut Seed: `apps/api/prisma/seed.ts` (654 satÄ±r)
ORM: Prisma + PostgreSQL (`sepe_natural` database)

---

## MEVCUT VERÄ°TABANI DURUMU

| Tablo | Model | Mevcut KayÄ±t | Durum |
|-------|-------|:------------:|-------|
| `users` | User | 1 | âœ… Yeterli (admin) |
| `stocks` | Stock | 1000 | âœ… Dolu (genel envanter) |
| `suppliers` | Supplier | 5 | âš ï¸ ArtÄ±rÄ±lmalÄ± (8-10 olmalÄ±) |
| `materials` | Material | 18 | âš ï¸ ArtÄ±rÄ±lmalÄ± (25-30 olmalÄ±) |
| `material_batches` | MaterialBatch | 20 | âš ï¸ ArtÄ±rÄ±lmalÄ± (her malzemeye 2-3 batch) |
| `products` | Product | 8 | âœ… Yeterli ama stoklarÄ± 0 âŒ |
| `recipes` | Recipe | 3 | âŒ Eksik â€” 8 Ã¼rÃ¼nÃ¼n sadece 3'Ã¼nÃ¼n reÃ§etesi var |
| `recipe_items` | RecipeItem | 9 | âŒ Eksik â€” yeni reÃ§etelerle artacak |
| `production_orders` | ProductionOrder | 8 | âœ… Yeterli |
| `production_batches` | ProductionBatch | 10 | âœ… Yeterli |
| `stock_movements` | StockMovement | 1 | âŒ KRÄ°TÄ°K â€” sadece 1 kayÄ±t var |
| `production_batch_consumptions` | ProductionBatchConsumption | 19 | âœ… Yeterli |
| `audit_logs` | AuditLog | 0 | ðŸ”· Normal (otomatik dolacak) |
| `entity_metadata` | EntityMetadata | 6 | âœ… Yeterli |
| `field_metadata` | FieldMetadata | 73 | âœ… Yeterli |
| `event_outbox` | EventOutbox | 0 | ðŸ”· Normal (otomatik dolacak) |

---

## MEVCUT VERÄ°LER (Ã–rnek)

### Malzemeler (18 adet)
```
HM-001 | Vitamin C (Askorbik Asit)        | RAW_MATERIAL | 250 Kg
HM-002 | Omega-3 BalÄ±k YaÄŸÄ± Konsantre     | RAW_MATERIAL | 180 Lt
HM-003 | D3 Vitamini (Kolekalsiferol)     | RAW_MATERIAL | 15 Kg
HM-004 | Ã‡inko Glukonat                   | RAW_MATERIAL | 120 Kg
HM-005 | Magnezyum Sitrat                 | RAW_MATERIAL | 200 Kg
HM-006 | Probiyotik KarÄ±ÅŸÄ±m (50B CFU)     | RAW_MATERIAL | 8 Kg
HM-007 | Kolajen Peptit (BalÄ±k KaynaklÄ±)  | RAW_MATERIAL | 45 Kg
HM-008 | Biotin (B7 Vitamini)             | RAW_MATERIAL | 3 Kg
HM-009 | Demir Bisglisinat                | RAW_MATERIAL | 65 Kg
HM-010 | Koenzim Q10 (Ubikinon)           | RAW_MATERIAL | 2.5 Kg
HM-011 | Kurkumin Ekstresi (%95)          | RAW_MATERIAL | 18 Kg
AM-001 | Jelatin KapsÃ¼l (BoÅŸ, Size 0)     | PACKAGING    | 500000 Adet
AM-002 | Cam ÅžiÅŸe 60ml (DamlalÄ±klÄ±)       | PACKAGING    | 15000 Adet
AM-003 | Blister Ambalaj (10'lu)           | PACKAGING    | 80000 Adet
AM-004 | Etiket ve Kutu Seti              | PACKAGING    | 25000 Adet
+ 3 ek malzeme (HM-012 â†’ HM-014 arasÄ± ya da ek PACKAGING)
```

### ÃœrÃ¼nler (8 adet â€” hepsinin stoku 0 âŒ)
```
PRD-001 | SepeNatural Vitamin C 1000mg       | 189.90 â‚º | REC-001 var âœ…
PRD-002 | SepeNatural Omega-3 BalÄ±k YaÄŸÄ±     | 249.90 â‚º | REC-002 var âœ…
PRD-003 | SepeNatural D3+K2 Vitamin          | 159.90 â‚º | REC-003 var âœ…
PRD-004 | SepeNatural Multivitamin           | 329.90 â‚º | ReÃ§ete YOK âŒ
PRD-005 | SepeNatural Probiyotik             | 279.90 â‚º | ReÃ§ete YOK âŒ
PRD-006 | SepeNatural Kolajen Peptit         | 399.90 â‚º | ReÃ§ete YOK âŒ
PRD-007 | SepeNatural Magnezyum Sitrat       | 149.90 â‚º | ReÃ§ete YOK âŒ
PRD-008 | SepeNatural CoQ10 200mg            | 449.90 â‚º | ReÃ§ete YOK âŒ
```

### TedarikÃ§iler (5 adet)
```
TED-001 | Vitamin DÃ¼nyasÄ± Kimya A.Åž.        | Ä°stanbul  | 7 gÃ¼n
TED-002 | DoÄŸal Hammadde Ltd. Åžti.           | Ä°stanbul  | 14 gÃ¼n
TED-003 | BioTech Ä°thalat Ä°hracat A.Åž.      | Ankara    | 21 gÃ¼n
TED-004 | Deniz BalÄ±k YaÄŸlarÄ± San. Tic.      | Ä°zmir     | 10 gÃ¼n
TED-005 | Ambalaj Plus Paketleme A.Åž.       | Bursa     | 5 gÃ¼n
```

### StockMovement (sadece 1 kayÄ±t âŒ)
Neredeyse tamamen boÅŸ â€” **en kritik eksik**.

---

## YAPILACAK Ä°ÅžLER â€” Seed Data GeniÅŸletme

Mevcut `seed.ts` dosyasÄ±nÄ± gÃ¼ncelleyerek Ã§alÄ±ÅŸtÄ±r VEYA yeni bir `seed-expand.ts` dosyasÄ± oluÅŸturup Ã§alÄ±ÅŸtÄ±r. **Mevcut verileri silme, Ã¼zerine ekle (upsert/skipDuplicates kullan).**

### GÃ–REV 1: Eksik 5 ÃœrÃ¼n Ä°Ã§in ReÃ§ete OluÅŸtur

Her reÃ§etede 3-5 malzeme satÄ±rÄ± (RecipeItem) olsun. Mevcut malzemeleri (HM-001 ~ HM-011, AM-001 ~ AM-004) kullan.

| ReÃ§ete | ÃœrÃ¼n | Malzemeler |
|--------|------|-----------|
| **REC-004** Multivitamin Tablet | PRD-004 | HM-001 (Vitamin C), HM-003 (D3), HM-004 (Cinko), HM-005 (Magnezyum), HM-009 (Demir), AM-003 (Blister), AM-004 (Kutu) |
| **REC-005** Probiyotik KapsÃ¼l | PRD-005 | HM-006 (Probiyotik), AM-001 (KapsÃ¼l), AM-004 (Kutu) |
| **REC-006** Kolajen 30 SaÅŸe | PRD-006 | HM-007 (Kolajen), HM-001 (Vitamin C â€” katkÄ±), AM-004 (Kutu) |
| **REC-007** Magnezyum Sitrat Tablet | PRD-007 | HM-005 (Magnezyum), AM-003 (Blister), AM-004 (Kutu) |
| **REC-008** CoQ10 200mg KapsÃ¼l | PRD-008 | HM-010 (CoQ10), AM-001 (KapsÃ¼l), AM-004 (Kutu) |

Her RecipeItem'da:
- `quantity`: GerÃ§ekÃ§i miktar (batchSize'a gÃ¶re hesapla)
- `unit`: Malzemenin unitOfMeasure'Ä± ile uyumlu
- `wastagePercent`: %1-5 arasÄ±
- `unitCost`: Malzemenin unitPrice'Ä±
- `totalCost`: `quantity Ã— unitPrice Ã— (1 + wastagePercent/100)`
- Recipe'nin `totalCost`: TÃ¼m item'larÄ±n totalCost toplamÄ±
- `batchSize`: ÃœrÃ¼nÃ¼n batchSize deÄŸerini kullan
- `batchUnit`: "Adet"
- `instructions`: TÃ¼rkÃ§e Ã¼retim talimatlarÄ± (2-3 cÃ¼mle)

---

### GÃ–REV 2: Malzeme Partileri ArtÄ±r (MaterialBatch)

Her malzemeye (HM-001 ~ HM-011) en az 2-3 parti ekle. Toplam ~35-40 batch olmalÄ±.

Her batch iÃ§in:
- `batchNumber`: `MB-{materialCode}-{YYYYMMDD}-{sÄ±ra}` formatÄ± (Ã–rn: `MB-HM004-20260120-01`)
- `supplierLotNo`: TedarikÃ§iye gÃ¶re format
- `manufacturingDate`: Son 3 ay iÃ§inde tarihler
- `expiryDate`: Malzemenin shelfLife'Ä±na gÃ¶re hesapla
- `quantity`: GerÃ§ekÃ§i miktar
- `remainingQuantity`: KullanÄ±ma gÃ¶re azaltÄ±lmÄ±ÅŸ (ama >0)
- `status`: DaÄŸÄ±lÄ±m â†’ %60 AVAILABLE, %15 RESERVED, %10 QUARANTINE, %10 CONSUMED, %5 EXPIRED
- `storageLocation`: "Hammadde Depo A / Raf 01" ~ "Raf 20" arasÄ±

---

### GÃ–REV 3: ÃœrÃ¼n StoklarÄ±nÄ± Doldur (Product.currentStock)

TamamlanmÄ±ÅŸ Ã¼retim emirleri var â†’ Ã¼rÃ¼nlerin stoÄŸu hesaplanmalÄ±:
- PRD-001 (Vitamin C): 5000 (UE-20260201-001 tamamlandÄ±) â†’ currentStock = 5000
- PRD-002 (Omega-3): 3000 (UE-20260203-001 tamamlandÄ±) â†’ currentStock = 3000
- PRD-003 (D3+K2): 1000 (kÄ±smen Ã¼retimde) â†’ currentStock = 1000
- PRD-004 ~ PRD-008: Yeni Ã¼retim emirleri/partiler de oluÅŸturulabilir â†’ her birine 500-2000 arasÄ± stok

Basit: `prisma.product.update({ where: { code: 'PRD-001' }, data: { currentStock: 5000 } })`

---

### GÃ–REV 4: Stok Hareketleri Doldur (StockMovement) â€” EN KRÄ°TÄ°K

GerÃ§ekÃ§i bir stok hareket geÃ§miÅŸi oluÅŸtur. Minimum **30 kayÄ±t**, ideal **50+ kayÄ±t**.

#### Senaryo AkÄ±ÅŸlarÄ±:

**A. Hammadde GiriÅŸleri (INBOUND) â€” 10 kayÄ±t**
TedarikÃ§ilerden malzeme alÄ±mlarÄ±. Son 2 ay iÃ§inde tarihleri daÄŸÄ±t.
```
SM-20260115-001 | INBOUND | HM-001 | 120 Kg  | â‚º450/Kg  | Toplam: â‚º54,000
SM-20260110-001 | INBOUND | HM-002 | 80 Lt   | â‚º890/Lt  | Toplam: â‚º71,200
SM-20260201-001 | INBOUND | HM-003 | 10 Kg   | â‚º2200/Kg | Toplam: â‚º22,000
SM-20260120-001 | INBOUND | HM-004 | 50 Kg   | â‚º320/Kg  | Toplam: â‚º16,000
SM-20260118-001 | INBOUND | HM-005 | 100 Kg  | â‚º280/Kg  | Toplam: â‚º28,000
SM-20260205-001 | INBOUND | HM-006 | 5 Kg    | â‚º4500/Kg | Toplam: â‚º22,500
SM-20260122-001 | INBOUND | HM-007 | 25 Kg   | â‚º1800/Kg | Toplam: â‚º45,000
SM-20260125-001 | INBOUND | AM-001 | 200000  | â‚º0.08    | Toplam: â‚º16,000
SM-20260128-001 | INBOUND | AM-002 | 8000    | â‚º2.50    | Toplam: â‚º20,000
SM-20260130-001 | INBOUND | AM-003 | 50000   | â‚º0.45    | Toplam: â‚º22,500
```

**B. Ãœretime Ã‡Ä±kÄ±ÅŸlar (PRODUCTION_OUT) â€” 8 kayÄ±t**
Ãœretim emirleri iÃ§in malzeme tÃ¼ketimleri.
```
SM-20260201-002 | PRODUCTION_OUT | HM-001 | 5.5 Kg  | ref: UE-20260201-001
SM-20260201-003 | PRODUCTION_OUT | AM-003 | 500     | ref: UE-20260201-001
SM-20260201-004 | PRODUCTION_OUT | AM-004 | 5000    | ref: UE-20260201-001
SM-20260203-002 | PRODUCTION_OUT | HM-002 | 4.2 Lt  | ref: UE-20260203-001
SM-20260203-003 | PRODUCTION_OUT | AM-001 | 3000    | ref: UE-20260203-001
SM-20260205-002 | PRODUCTION_OUT | HM-003 | 0.12 Kg | ref: UE-20260205-001
SM-20260208-002 | PRODUCTION_OUT | HM-001 | 3.3 Kg  | ref: UE-20260208-001
SM-20260208-003 | PRODUCTION_OUT | AM-001 | 3000    | ref: UE-20260208-001
```

**C. Ãœretimden GiriÅŸler (PRODUCTION_IN) â€” 5 kayÄ±t**
Tamamlanan Ã¼retim partilerinden Ã¼rÃ¼n giriÅŸi.
```
SM-20260204-001 | PRODUCTION_IN | PRD-001 (product) | 5000 Adet | ref: UE-20260201-001
SM-20260206-001 | PRODUCTION_IN | PRD-002 (product) | 3000 Adet | ref: UE-20260203-001
SM-20260210-001 | PRODUCTION_IN | PRD-003 (product) | 1000 Adet | ref: UE-20260205-001
```

**D. SatÄ±ÅŸ Ã‡Ä±kÄ±ÅŸlarÄ± (OUTBOUND) â€” 5 kayÄ±t**
```
SM-20260207-001 | OUTBOUND | PRD-001 (product) | 500 Adet  | â‚º189.90/Adet
SM-20260209-001 | OUTBOUND | PRD-002 (product) | 200 Adet  | â‚º249.90/Adet
SM-20260211-001 | OUTBOUND | PRD-001 (product) | 1000 Adet | â‚º189.90/Adet
SM-20260212-001 | OUTBOUND | PRD-002 (product) | 500 Adet  | â‚º249.90/Adet
SM-20260213-001 | OUTBOUND | PRD-003 (product) | 300 Adet  | â‚º159.90/Adet
```

**E. Manuel DÃ¼zeltmeler (ADJUSTMENT) â€” 3 kayÄ±t**
```
SM-20260210-002 | ADJUSTMENT | HM-008 | +0.5 Kg  | "SayÄ±m sonrasÄ± dÃ¼zeltme"
SM-20260212-002 | ADJUSTMENT | AM-004 | -500      | "HasarlÄ± ambalaj"
SM-20260213-002 | ADJUSTMENT | HM-011 | +2 Kg    | "TedarikÃ§iden ek teslimat"
```

**F. Fire/Hurda (WASTE) â€” 2 kayÄ±t**
```
SM-20260206-002 | WASTE | HM-002 | 0.5 Lt  | "SÄ±caklÄ±k sapmasÄ±, Ã¼rÃ¼n bozuldu"
SM-20260211-002 | WASTE | AM-003 | 200     | "BaskÄ± hatasÄ±, kullanÄ±lamaz"
```

**G. Ä°adeler (RETURN) â€” 2 kayÄ±t**
```
SM-20260209-002 | RETURN | PRD-001 (product) | 50 Adet | "MÃ¼ÅŸteri iadesi - ambalaj hasarÄ±"
SM-20260213-003 | RETURN | HM-009            | 5 Kg    | "TedarikÃ§iye kalite iadesi"
```

Her StockMovement kaydÄ±nda:
- `movementNumber`: Unique, `SM-YYYYMMDD-NNN` formatÄ±
- `type`: StockMovementType enum
- `materialId` veya `productId`: Ä°lgili kayÄ±ttan ID Ã§ek
- `materialBatchId`: EÄŸer malzeme hareketi ise, ilgili batch ID (opsiyonel)
- `quantity`: Miktar (Decimal)
- `unit`: Birim
- `previousStock`: Hareket Ã¶ncesi stok
- `newStock`: Hareket sonrasÄ± stok
- `unitPrice`: Birim fiyat
- `totalValue`: quantity Ã— unitPrice
- `referenceType`: "PRODUCTION_ORDER", "PURCHASE", "SALE", "MANUAL"
- `referenceId`: Ä°lgili sipariÅŸ/emir numarasÄ±
- `description`: TÃ¼rkÃ§e aÃ§Ä±klama
- `performedBy`: "Ahmet Usta", "Mehmet Depo", "Sistem", "Zeynep Teknisyen" vb.
- `createdAt`: GerÃ§ekÃ§i tarih/saat

---

### GÃ–REV 5: 3 Yeni TedarikÃ§i + Yeni Malzemeler

```
TED-006 | Anadolu Bitkisel Ã–zler A.Åž.  | Konya    | 12 gÃ¼n | Bitkisel ekstreler
TED-007 | Global Minerals Trading GmbH  | Almanya  | 30 gÃ¼n | Ä°thal mineraller
TED-008 | Akdeniz Ambalaj San. Tic.     | Antalya  | 7 gÃ¼n  | Ã–zel ambalaj
```

Yeni malzemeler (mevcut HM-012 ~ HM-018, AM-005 ~ AM-006):
```
HM-012 | K2 Vitamini (MK-7)             | RAW_MATERIAL | TED-003 | â‚º8500/Kg | 1 Kg
HM-013 | Selenyum (Seleno-Metiyonin)     | RAW_MATERIAL | TED-007 | â‚º9200/Kg | 0.5 Kg
HM-014 | Lutein (Kadife Ã‡iÃ§eÄŸi Ekst.)    | RAW_MATERIAL | TED-006 | â‚º6800/Kg | 2 Kg
HM-015 | Folik Asit (B9 Vitamini)        | RAW_MATERIAL | TED-001 | â‚º1200/Kg | 10 Kg
HM-016 | B12 Vitamini (Metilkobalamin)   | RAW_MATERIAL | TED-003 | â‚º15000/Kg| 0.3 Kg
HM-017 | ZerdeÃ§al Ekstresi               | RAW_MATERIAL | TED-006 | â‚º2800/Kg | 12 Kg
HM-018 | Karabiber Ekstresi (Piperin)    | RAW_MATERIAL | TED-006 | â‚º3500/Kg | 5 Kg
AM-005 | SaÅŸe Ambalaj (5g)               | PACKAGING    | TED-008 | â‚º0.35    | 40000
AM-006 | HDPE ÅžiÅŸe 90 KapsÃ¼l             | PACKAGING    | TED-008 | â‚º1.80    | 10000
```

---

### GÃ–REV 6: Yeni Malzeme Partileri (Eklenen Malzemeler Ä°Ã§in)

Eklenen her malzeme iÃ§in en az 1 parti oluÅŸtur.

---

### GÃ–REV 7: Ek Ãœretim Emirleri (Yeni ReÃ§eteler Ä°Ã§in)

Yeni reÃ§eteleri (REC-004 ~ REC-008) kullanan 5 Ã¼retim emri:
```
UE-20260215-001 | PRD-004 | REC-004 | 4000 Adet | PLANNED   | Åžubat sonu Ã¼retim
UE-20260216-001 | PRD-005 | REC-005 | 2000 Adet | DRAFT     | Mart planlamasÄ±
UE-20260217-001 | PRD-006 | REC-006 | 1500 Adet | PLANNED   | Kolajen serisi
UE-20260218-001 | PRD-007 | REC-007 | 5000 Adet | PLANNED   | Magnezyum ilk batch
UE-20260219-001 | PRD-008 | REC-008 | 1000 Adet | DRAFT     | CoQ10 pilot Ã¼retim
```

---

## TEKNÄ°K KURALLAR

1. **Dosya:** `apps/api/prisma/seed-expand.ts` olarak AYRI dosya oluÅŸtur
2. **Import:** `import { PrismaClient, MaterialType, StockMovementType, ProductionOrderStatus, MaterialBatchStatus } from '@prisma/client';`
3. **Mevcut veriyi silme:** `createMany({ skipDuplicates: true })` veya `upsert` kullan
4. **ID referanslarÄ±:** Her zaman `prisma.X.findFirst({ where: { code: 'XXX' } })` ile dinamik ID Ã§ek
5. **Transaction:** StockMovement oluÅŸtururken material/product stok gÃ¼ncelleme gerektiren iÅŸlemlerde transaction kullan
6. **Ã‡alÄ±ÅŸtÄ±rma:**
   ```bash
   cd apps/api
   npx ts-node prisma/seed-expand.ts
   ```
7. **SÄ±ralama:** Supplier â†’ Material â†’ MaterialBatch â†’ Recipe â†’ RecipeItem â†’ ProductionOrder â†’ StockMovement â†’ Product stok gÃ¼ncelle
8. **Decimal:** Prisma Decimal alanlarÄ± iÃ§in sayÄ±sal deÄŸer kullan (string deÄŸil)
9. **Tarih:** `new Date('2026-02-14T08:30:00')` formatÄ± kullan, tarihler Ocak-Åžubat 2026 aralÄ±ÄŸÄ±nda
10. **previousStock/newStock hesaplama:** Her stok hareketi oluÅŸturmadan Ã¶nce mevcut stoÄŸu oku, sonra gÃ¼ncelle

---

## SONUÃ‡ HEDEFÄ°

Seed Ã§alÄ±ÅŸtÄ±ktan sonra beklenen tablo durumlarÄ±:

| Tablo | Hedef KayÄ±t |
|-------|:-----------:|
| Supplier | 8 |
| Material | 27+ |
| MaterialBatch | 45+ |
| Product | 8 (stoklu) |
| Recipe | 8 |
| RecipeItem | 30+ |
| ProductionOrder | 13+ |
| StockMovement | 35+ |
| DiÄŸerleri | Mevcut deÄŸer korunacak |
